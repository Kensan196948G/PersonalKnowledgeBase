# Phase 4 エグゼクティブサマリー - AI連携機能

## 概要

Phase 4では、ローカルファースト・プライバシー重視のAI連携機能を実装し、個人ナレッジベースを「インテリジェント・ナレッジベース」へと進化させます。

---

## 主要機能（5つ）

### 1. セマンティック検索
**意味ベースの検索で過去のメモを発見**
- キーワードではなく「意味」で検索
- ハイブリッド検索（セマンティック + キーワード）
- 検索精度80%以上、2秒以内の応答

### 2. AI要約
**長文メモを素早く把握**
- 3スタイル：簡潔（1-2文）、詳細（1段落）、箇条書き
- Ollama + Llama 3.2（ローカルLLM）
- 10秒以内の応答

### 3. 質問応答（RAG）
**ナレッジベース全体に質問**
- 「先月のプロジェクトの進捗は？」などの自然言語質問
- RAG（Retrieval-Augmented Generation）技術
- 引用元ノート表示（トレーサビリティ）

### 4. タグ自動提案
**AIがタグを提案**
- ノート内容を分析して適切なタグを提案
- 既存タグとの整合性維持
- タグ付け忘れ防止

### 5. 文章校正
**AIが文章をチェック**
- 誤字脱字検出
- 文法・スタイル改善提案
- 可読性スコア表示

---

## 技術スタック

| レイヤー | 技術 | 選定理由 |
|----------|------|----------|
| **ベクトルDB** | LanceDB | Node.js対応、高速、ローカル完結 |
| **埋め込みモデル** | nomic-embed-text | 768次元、高精度、Ollama対応 |
| **LLM** | Llama 3.2 | 軽量、高性能、ローカル実行 |
| **LLMプロバイダー** | Ollama | プライバシー重視、無料、簡単 |
| **バックエンド** | Node.js + Express | 既存システムと統合 |
| **フロントエンド** | React + TypeScript | 既存システムと統合 |

---

## 4並列SubAgent タスク分割

| SubAgent | 担当範囲 | 推定工数 |
|----------|----------|----------|
| **SubAgent 1** | ベクトルDB統合、埋め込み生成 | 12時間 |
| **SubAgent 2** | セマンティック検索、RAGエンジン | 18時間 |
| **SubAgent 3** | AI機能API（要約、Q&A、タグ提案） | 16時間 |
| **SubAgent 4** | フロントエンドUI、設定画面 | 18時間 |

**総推定工数**: 80時間（実作業5週間） + バッファ25時間 = **105時間**

---

## 5週間スケジュール

```
Week 1: Sprint 1 - ベクトルDB統合
  └─ LanceDB、Ollama連携、埋め込み生成

Week 2: Sprint 2 - セマンティック検索
  └─ 意味検索API、ハイブリッド検索、UI

Week 3: Sprint 3 - AI要約
  └─ LLMクライアント、要約API、タグ提案

Week 4: Sprint 4 - Q&A
  └─ RAGエンジン、質問応答API、チャットUI

Week 5: Sprint 5 - 最終調整
  └─ 文章校正、設定画面、統合テスト
```

---

## データベース設計

### 新規テーブル（3つ）

1. **NoteEmbedding** - ノート埋め込み管理
2. **AIInteraction** - AI使用履歴・ログ
3. **AIConfiguration** - AI機能設定

### ベクトルDB（LanceDB）

- ディレクトリ: `data/lancedb/`
- スキーマ: 768次元ベクトル + メタデータ
- 検索方式: K-NN（K近傍法）、コサイン類似度

---

## アーキテクチャ概要

```
┌─────────────────────────────────────────────┐
│         Frontend (React)                    │
│  ┌────────┐  ┌────────┐  ┌────────┐        │
│  │Semantic│  │Summary │  │Q&A Chat│        │
│  │Search  │  │Panel   │  │        │        │
│  └────────┘  └────────┘  └────────┘        │
└──────────────────┬──────────────────────────┘
                   │ REST API
┌──────────────────▼──────────────────────────┐
│         Backend (Express)                   │
│  ┌─────────────────────────────────────┐   │
│  │  AI Service Layer                   │   │
│  │  - Embedding Service                │   │
│  │  - RAG Engine                       │   │
│  │  - LLM Client                       │   │
│  └─────────────────────────────────────┘   │
└──────────────────┬──────────────────────────┘
                   │
┌──────────────────▼──────────────────────────┐
│  Data Layer                                 │
│  ┌──────┐  ┌──────┐  ┌──────┐             │
│  │SQLite│  │LanceDB│  │Ollama│             │
│  │(Meta)│  │(Vec) │  │(LLM) │             │
│  └──────┘  └──────┘  └──────┘             │
└─────────────────────────────────────────────┘
```

---

## Phase 3との統合

| Phase 3機能 | Phase 4での活用 |
|-------------|-----------------|
| ノート間リンク | RAGコンテキストに活用 |
| バックリンク | 関連性スコアリング補助 |
| 関連ノート | セマンティック検索と統合 |
| タグシステム | タグ提案のトレーニングデータ |

---

## リスクと対策

### 高リスク

| リスク | 対策 |
|--------|------|
| Ollama依存性 | ヘルスチェック、フォールバック（OpenAI API） |
| LLM品質（幻覚） | プロンプト最適化、引用元明示 |
| パフォーマンス | キャッシュ、インデックス最適化 |

### 中リスク

| リスク | 対策 |
|--------|------|
| プライバシー懸念 | ローカルLLM優先、外部API同意フロー |
| ベクトルDB容量 | 定期クリーンアップ、圧縮 |

---

## 完了条件（Definition of Done）

### 機能
- [ ] セマンティック検索動作（精度80%以上）
- [ ] AI要約3スタイル動作（品質75%以上）
- [ ] Q&A動作（精度75%以上、引用元表示）
- [ ] タグ提案動作（精度70%以上）
- [ ] 文章校正動作

### パフォーマンス
- [ ] 埋め込み生成: < 5秒
- [ ] セマンティック検索: < 2秒
- [ ] LLM応答: < 10秒

### テスト
- [ ] ユニットテストカバレッジ 80%以上
- [ ] 統合テスト全パス
- [ ] E2Eテスト主要フロー全パス

### ドキュメント
- [ ] ユーザーガイド作成
- [ ] 開発者ドキュメント作成
- [ ] APIドキュメント更新

---

## 期待される効果

1. **知識の再発見**: 意味検索で忘れたメモを発見
2. **効率化**: AI要約で長文を素早く理解
3. **知識統合**: Q&Aで散在する情報を統合
4. **プライバシー**: 全データがローカルに残る
5. **Phase 5への基盤**: マルチモーダルAI対応

---

## 次のアクション

1. **今すぐ**: このサマリーをレビュー
2. **Week 0**: Ollama環境構築、モデルダウンロード
3. **Week 1**: Sprint 1開始（SubAgent 1: ベクトルDB統合）
4. **詳細**: `Phase4_Implementation_Roadmap.md` を参照

---

**Phase 4 完了目標**: 2026年1月末
**次のフェーズ**: Phase 5（マルチモーダルAI）

---

作成日: 2025-12-14
Phase: Phase 4 計画
