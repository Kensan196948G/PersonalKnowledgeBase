# 次の開発ステップ - Personal Knowledge Base

作成日: 2025-12-16
最終更新: 2025-12-16

---

## プロジェクト現況サマリー

### 完了済みフェーズ

| フェーズ | 完了日 | 主要成果 |
|---------|--------|----------|
| Phase 1: MVP | 2025-12-13 | TipTap、画像貼り付け、基本検索 |
| Phase 2: 整理機能 | 2025-12-13 | タグ、フォルダ、高度検索 |
| Phase 3: 知識化 | 2025-12-14 | ノート間リンク、バックリンク、グラフビュー、E2E テスト |

### Phase 4: AI連携 - 部分実装済み

| 機能 | 状態 | 備考 |
|------|------|------|
| Ollama統合 | ✅ 実装済み | ollamaClient.ts |
| 埋め込み生成 | ✅ 実装済み | embeddingService.ts |
| AI要約 | ✅ 実装済み | summarizeService.ts |
| ベクトルDB (LanceDB) | ⏳ 未実装 | Phase 4 Roadmapに記載 |
| セマンティック検索 | ⏳ 未実装 | Phase 4 Roadmapに記載 |
| RAG (Q&A) | ⏳ 未実装 | Phase 4 Roadmapに記載 |
| テスト | ⚠️ 一部スキップ | Ollama依存テスト無効化 |

### データ実績

| 項目 | 数値 |
|------|------|
| OneNote日記インポート | 365日分（2025年） |
| フォルダ階層 | 完全動作 |
| UI/UXバグ | 修正完了（エディタ拡大、自動折りたたみ） |
| 総コード量 | 9,914行（推定） |

---

## 1. 短期目標（次回セッション）

### 優先度: 最高

#### 1.1 Phase 4テスト整備（推定: 2-3時間）

**目的**: 開発環境とCI/CDでテストを確実に動作させる

**タスク**:

1. **Ollamaモックテスト実装**
   ```bash
   tests/backend/ai/ollamaClient.test.ts  # 既存（スキップ中）
   tests/backend/ai/embeddingService.test.ts  # 追加
   tests/backend/ai/summarizeService.test.ts  # 追加
   ```
   - モックを使用してOllama依存を排除
   - CI/CDで常時実行可能な状態に

2. **ユニットテストカバレッジ向上**
   - 目標: 80%以上
   - 現状確認: `npm run test:coverage` で測定
   - 優先: AI関連サービス、バックエンドAPI

3. **E2Eテスト追加（Playwright）**
   - フォルダフィルタリング動作確認
   - タグフィルタリング動作確認
   - ノート間リンク動作確認

**完了条件**:
- [ ] 全テストがCI/CDで通過
- [ ] カバレッジレポート生成
- [ ] E2Eテストで主要フロー検証

#### 1.2 CLAUDE.md更新（推定: 30分）

**タスク**:

1. **Phase 4の進捗を反映**
   ```markdown
   ### Phase 4: AI連携 ⚠️ 部分実装済み（2025-12-15）
   - [x] Ollama統合
   - [x] 埋め込み生成サービス
   - [x] AI要約機能
   - [ ] LanceDBベクトル検索
   - [ ] セマンティック検索API
   - [ ] RAG (Q&A)
   - [ ] フロントエンドUI統合
   ```

2. **OneNote統合の実績を記録**
   ```markdown
   ### 主要実績
   - OneNote 2025年日記（365日分）インポート完了
   - フォルダフィルタリング完全動作
   - UI/UX改善（エディタ拡大、自動折りたたみ）
   ```

**完了条件**:
- [ ] CLAUDE.mdのPhase 4セクション更新
- [ ] 進捗管理.mdに最新状況反映

---

## 2. 中期目標（Phase 4.5 完成）

### 推定期間: 2-3週間（15-20時間）

### 2.1 LanceDBベクトル検索実装（8-10時間）

**目的**: セマンティック検索の基盤構築

**タスク（Phase 4 Roadmap Sprint 1-2準拠）**:

1. **LanceDB統合** (3-4h)
   - `src/backend/services/vectordb/lancedb.ts` 作成
   - データベース初期化
   - CRUD操作実装

2. **埋め込みバックグラウンドワーカー** (3-4h)
   - `src/backend/services/ai/embeddingWorker.ts` 作成
   - 未埋め込みノート自動処理
   - 定期実行スケジューラー

3. **セマンティック検索API** (2-3h)
   - `GET /api/search/semantic` エンドポイント
   - ハイブリッド検索（セマンティック + キーワード）
   - フィルタリング統合

**完了条件**:
- [ ] LanceDB初期化・接続確認
- [ ] 既存365ノートの埋め込み生成
- [ ] セマンティック検索動作確認
- [ ] 検索速度 < 2秒（365ノート環境）

### 2.2 RAG (Q&A) 機能実装（5-7時間）

**目的**: ナレッジベースへの質問応答機能

**タスク（Phase 4 Roadmap Sprint 4準拠）**:

1. **RAGエンジン** (3-4h)
   - `src/backend/services/ai/ragEngine.ts` 作成
   - Top 5ノート取得
   - コンテキスト構築
   - プロンプトエンジニアリング

2. **Q&A API** (1-2h)
   - `POST /api/ai/qa` エンドポイント
   - 引用元ノート付与
   - ログ記録

3. **Q&Aチャット UI** (1-2h)
   - `src/frontend/components/AI/QAChat.tsx` 作成
   - チャット形式UI
   - 引用元リンク表示

**完了条件**:
- [ ] 質問応答動作確認
- [ ] 引用元が正しく表示される
- [ ] 応答時間 < 10秒

### 2.3 フロントエンド統合（2-3時間）

**タスク**:

1. **セマンティック検索UI**
   - `src/frontend/components/Search/SemanticSearch.tsx` 作成
   - モード切替（セマンティック / キーワード / ハイブリッド）
   - 検索結果スコア表示

2. **AI設定画面**
   - `src/frontend/components/Settings/AISettings.tsx` 作成
   - Ollama接続設定
   - モデル選択（llama3.2, nomic-embed-text等）
   - 機能有効化トグル

**完了条件**:
- [ ] セマンティック検索UIから検索可能
- [ ] AI設定画面でOllama接続テスト可能

---

## 3. 長期目標（Phase 5 以降）

### 3.1 Phase 5: マルチモーダルAI（推定: 30-40時間）

**実装時期**: Phase 4完成後（2-3ヶ月後）

| 機能 | 技術スタック | 優先度 |
|------|-------------|--------|
| **画像OCR** | Tesseract.js | 高 |
| **音声メモ** | Whisper (Ollama) | 中 |
| **PDF要約** | LLM + PDF.js | 中 |
| **画像認識** | LLaVA (Ollama) | 低 |

**ユースケース**:
- 手書きメモをOCRで検索可能に
- 会議録音を文字起こし＋要約
- PDFレポートを自動要約＋ノート化

### 3.2 Phase 6: 知識グラフ可視化（推定: 20-30時間）

**実装時期**: Phase 5後（4-6ヶ月後）

| 機能 | 技術スタック | 優先度 |
|------|-------------|--------|
| **グラフ可視化拡張** | D3.js v7 | 高 |
| **クラスター分析** | LLM + Graph算出 | 中 |
| **トピック抽出** | BERTopic (Python?) | 低 |

**ユースケース**:
- ノート間の関連性を視覚的に把握
- 孤立ノートの検出
- 知識の偏りを発見

### 3.3 Phase 7: エージェント機能（推定: 40-50時間）

**実装時期**: Phase 6後（6-12ヶ月後）

| 機能 | 概要 | 優先度 |
|------|------|--------|
| **スマートアシスタント** | 定期的な知識整理提案 | 中 |
| **重複ノート検出** | 自動統合提案 | 高 |
| **知識自動リンク** | 関連ノートの自動リンク | 中 |

**ユースケース**:
- 週次で「整理が必要なノート」を提案
- 似たようなメモを検出して統合提案
- 関連性の高いノートを自動リンク

---

## 4. 優先順位付き実装推奨事項

### P0: 即座に対応すべき（次回セッション）

| 項目 | 理由 | 工数 |
|------|------|------|
| **テスト整備** | CI/CDの安定化、品質保証 | 2-3h |
| **CLAUDE.md更新** | 現状把握、Phase 4進捗明確化 | 0.5h |

### P1: Phase 4.5 完成のため必須（2-3週間以内）

| 項目 | 理由 | 工数 |
|------|------|------|
| **LanceDBベクトル検索** | セマンティック検索の基盤 | 8-10h |
| **RAG (Q&A)** | AI連携の中核機能 | 5-7h |
| **フロントエンド統合** | ユーザー利用可能にする | 2-3h |

### P2: Phase 4完全版（1-2ヶ月以内）

| 項目 | 理由 | 工数 |
|------|------|------|
| **文章校正API** | スマート機能の完成 | 2-3h |
| **タグ提案API** | AI活用の実用性向上 | 2-3h |
| **パフォーマンス最適化** | 大量ノート対応 | 3-4h |
| **ドキュメント整備** | ユーザーガイド、開発者ドキュメント | 2-3h |

### P3: 将来的な拡張（3ヶ月以降）

| 項目 | 理由 | 工数 |
|------|------|------|
| **Phase 5: マルチモーダルAI** | 画像・音声対応 | 30-40h |
| **Phase 6: 知識グラフ** | 可視化・分析強化 | 20-30h |
| **Phase 7: エージェント** | 自動化・整理支援 | 40-50h |

---

## 5. 技術的負債と改善事項

### 5.1 現在の課題

| 課題 | 影響度 | 緊急度 | 対応策 |
|------|--------|--------|--------|
| **Ollamaテストのスキップ** | 高 | 高 | モック実装でCI/CD対応 |
| **フロントエンドテスト未実装** | 中 | 中 | Vitestで段階的に追加 |
| **Phase 4 UI未統合** | 中 | 中 | 2-3時間で統合可能 |
| **LanceDB未導入** | 中 | 中 | Phase 4.5で対応 |

### 5.2 推奨改善

| 改善項目 | 効果 | 工数 |
|---------|------|------|
| **E2Eテスト拡充** | リグレッション防止 | 1-2h |
| **エラーハンドリング強化** | UX向上 | 1-2h |
| **ログ構造化** | デバッグ効率化 | 1h |
| **API型定義の共有化** | 型安全性向上 | 1h |

---

## 6. 次のアクション（具体的コマンド）

### 6.1 次回セッション開始時

```bash
# 1. テスト状況確認
npm test
npm run test:coverage

# 2. Phase 4の実装確認
ls -la src/backend/services/ai/
ls -la src/backend/services/vectordb/

# 3. 進捗ドキュメント確認
cat docs/09_開発フェーズ（Development）/進捗管理（Progress）.md
cat docs/09_開発フェーズ（Development）/Phase4_COMPLETION_REPORT.md

# 4. CLAUDE.md更新
# エディタで編集（Phase 4進捗反映）
```

### 6.2 Phase 4.5 開始時

```bash
# LanceDB導入
npm install vectordb apache-arrow

# データベーススキーマ確認
cat prisma/schema.prisma | grep -A 10 "NoteEmbedding"

# Phase 4 Roadmap参照
cat docs/09_開発フェーズ（Development）/Phase4_Implementation_Roadmap.md
```

---

## 7. まとめ

### 現在地

```
Phase 1 (MVP)          [██████████] 100% ✅
Phase 2 (整理機能)      [██████████] 100% ✅
Phase 3 (知識化)        [██████████] 100% ✅
Phase 4 (AI連携)       [█████░░░░░]  50% ⚠️ (Ollama統合済み、ベクトル検索未)
Phase 5 (マルチモーダル) [░░░░░░░░░░]   0% 📋 (計画済み)
```

### 次の3ステップ

1. **短期（次回セッション）**: テスト整備 + CLAUDE.md更新（2-3時間）
2. **中期（2-3週間）**: LanceDB + RAG + フロントエンド統合（15-20時間）
3. **長期（3ヶ月以降）**: Phase 5（マルチモーダルAI）開始（30-40時間）

### 推奨開始順序

```
1. テスト整備（P0）
   ↓
2. CLAUDE.md更新（P0）
   ↓
3. LanceDBベクトル検索（P1）
   ↓
4. RAG (Q&A)（P1）
   ↓
5. フロントエンド統合（P1）
   ↓
6. Phase 4完全版（P2）
   ↓
7. Phase 5計画（P3）
```

---

**作成理由**: Phase 4が部分実装状態（Ollama統合済み、ベクトル検索未）のため、次の開発ステップを明確化

**参照ドキュメント**:
- `CLAUDE.md` - プロジェクト概要
- `docs/09_開発フェーズ（Development）/Phase4_Implementation_Roadmap.md` - 詳細ロードマップ
- `docs/09_開発フェーズ（Development）/Phase4_COMPLETION_REPORT.md` - Phase 4完了レポート
- `docs/09_開発フェーズ（Development）/進捗管理（Progress）.md` - 進捗管理（要更新）

**最終更新**: 2025-12-16
