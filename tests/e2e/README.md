# E2Eテスト - ノート間リンク機能

## 概要

このディレクトリには、ノート間リンク機能（Phase 3）のE2Eテストが含まれています。Playwrightを使用して、実際のブラウザ環境でユーザーシナリオをテストします。

## テストファイル

### noteLinks.spec.ts

ノート間リンク機能の包括的なE2Eテスト（全8シナリオ）

#### テストシナリオ

1. **シナリオ1: [[ノート名]] でリンクが作成される**
   - `[[ノート名]]` 記法でリンクを作成
   - オートコンプリートの表示確認
   - リンクが青色で表示されることを確認

2. **シナリオ2: リンククリックで対象ノートに遷移する**
   - リンクをクリック
   - 対象ノートへの遷移確認
   - 内容が正しく表示されることを確認

3. **シナリオ3: バックリンクパネルに参照元ノートが表示される**
   - 複数の参照元ノートを作成
   - バックリンクパネルの表示確認
   - 参照元ノートの一覧表示確認

4. **シナリオ4: 関連ノートウィジェットにスコア付きで表示される**
   - 共通タグを持つノートを作成
   - ノート間リンクを追加
   - 関連ノートの表示確認
   - スコアリングの確認（実装次第）

5. **シナリオ5: 存在しないノートへのリンクは赤色で表示される（赤リンク）**
   - 存在しないノートへのリンクを作成
   - 赤色で表示されることを確認
   - クリック時の動作確認

6. **追加シナリオ: リンク削除後にバックリンクが更新される**
   - リンクを削除
   - バックリンクが更新されることを確認

7. **追加シナリオ: 双方向リンクが正しく動作する**
   - A→B、B→Aの双方向リンクを作成
   - 両方向でリンクとバックリンクが表示されることを確認

8. **パフォーマンス: 大量のリンクでも快適に動作する**
   - 10個のバックリンクを持つノートを作成
   - 3秒以内に読み込まれることを確認
   - すべてのバックリンクが表示されることを確認

## テスト実行方法

### 前提条件

- Node.js 20以上
- Playwrightブラウザがインストール済み

Playwrightブラウザのインストール:

```bash
npx playwright install chromium
```

### テスト実行コマンド

#### 通常実行（ヘッドレスモード）

```bash
npm run test:e2e
```

#### UIモード（推奨：デバッグ時）

```bash
npm run test:e2e:ui
```

#### ブラウザを表示して実行

```bash
npm run test:e2e:headed
```

#### デバッグモード

```bash
npm run test:e2e:debug
```

#### レポート表示

```bash
npm run test:e2e:report
```

### 特定のテストのみ実行

```bash
# シナリオ1のみ実行
npx playwright test -g "シナリオ1"

# バックリンク関連のみ実行
npx playwright test -g "バックリンク"
```

## テスト結果

テスト実行後、以下が生成されます：

- `playwright-report/` - HTMLレポート
- `test-results/` - スクリーンショット、ビデオ、トレース

## トラブルシューティング

### テストがタイムアウトする

開発サーバーが正しく起動しているか確認してください：

```bash
npm run dev
```

別のターミナルでテストを実行：

```bash
npm run test:e2e
```

### セレクタが見つからない

UIが実装されているか確認してください。data-testid属性が設定されていない場合、クラス名やテキストベースのセレクタを使用しています。

### ブラウザのインストールエラー

```bash
npx playwright install --force chromium
```

## CI/CD統合

`.github/workflows/e2e.yml` を参照してください（別途作成）。

## 注意事項

- テストはフロントエンドとバックエンドの両方が起動している必要があります
- データベースは各テストで独立している必要があります（将来的にテストDB導入を検討）
- 現在は開発DBを使用しているため、テストデータが残る可能性があります

## 今後の改善点

- [ ] テスト専用のDBを使用
- [ ] テスト前にDBをクリーンアップ
- [ ] data-testid属性を各コンポーネントに追加
- [ ] スナップショットテストの追加
- [ ] アクセシビリティテストの追加
- [ ] モバイルビューのテスト
